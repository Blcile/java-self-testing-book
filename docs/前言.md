前言
====

为什么要写这样一本书
--------------------

有很多图书介绍怎么做测试，但是很少有写给开发人员的软件测试图书。软件质量是决定一款软件是否能用的底线，软件质量低下，会造成开发人员不断地返工和修复
Bug，而这需要付出巨大的代价，侵占原本紧凑的开发时间。

因此，越来越多的开发团队尝试从研发团队内部提高软件质量，为的是尽早发现问题，降低成本。微软甚至取消专门的测试部门而改由开发人员来保证自己产出软件的质量，因为只有开发人员自己才最熟悉代码中的每一个异常分支。一些公司也开始为提高开发人员的测试能力而展开培训，他们希望通过把控研发的自测环节来提升软件质量。

软件测试的种类和分类方法非常多，研发自测的理念是交付质量主要由开发者保障。研发自测的主要内容有单元测试、集成测试等。研发自测并不只是局限于让开发人员编写单元测试，而是围绕着单元测试和集成测试来提高软件质量，一些软件测试的基本知识对于开发人员同样重要。例如，在实践中我们发现，代码评审对一个项目是否成功起到了至关重要的作用，具备软件测试的基本知识就能对单元测试的代码做出合理的评价。

Thoughtworks
是一家将研发自测贯穿于软件项目始终的公司，作为该公司的员工，我有幸为一些企业提供了研发自测相关的培训，包括单元测试、TDD、代码静态扫描等内容。单元测试、TDD
的落地需要结合项目的技术栈来实现。目前，Spring Boot
被广泛使用，但是较少有资料介绍如何通过整合 JUnit、Spring Boot
等框架构成一套完整单元测试和API 测试，本书将针对这部分内容进行详细说明。

另外，开发人员在写易于维护和规范的自动化测试时，往往会受限于框架、基础设施等。市面上讲解单元测试的图书没有结合
Spring
等框架给出一个在实战环境下的测试策略，这本书尝试描述在实战中编写单元测试、API
测试的经验和方法。

在构建服务器应用时，性能、并发安全也不容易被验证，本书希望通过讨论如何为性能检查、并发问题检测等场景编写测试，来提高软件的健壮性，让服务器应用能更稳定地运行。

最后，在测试过程中，如果不熟悉单元测试的原理和机制，就会花费大量的时间在修复测试的问题上，这无疑会造成浪费，所以书中还会介绍一些基本的测试框架原理。我们知道，现代化的软件测试往往不能通过单一的工具完成，因此本书中还介绍了大量的开源工具，用以构成软件测试中常用的工具链，这些工具的清单可以在本书的附录中找到。

读者对象
--------

本书主要适合以下两类读者阅读：

-   负责公司软件质量的相关人员。本书有助于他们认识开发者、测试人员在测试过程中的作用和承担的职责，阅读并掌握本书的内容，可以让他们对开发者做一些基本的培训。

-   Java 开发人员。本书提供了一些代码示例，可帮助Java
    开发人员从零开始搭建自己的测试代码框架，并进行测试相关的技术选型，还可以掌握在工作中进行代码评审的技巧，从而解决测试过程中的相关问题。

如何阅读本书
------------

本书共 11
章，依据日常工作对这些内容使用的频率可将本书内容分为三部分：研发自测基础篇、研发测试高级篇、源码分析篇。本章的章节之间没有强依赖关系，读者可以自己对测试的熟悉情况挑选相应的章节进行阅读。

研发自测基础篇（第1\~6章），主要介绍了日常工作使用频率最高的基础知识，包括软件测试的基本概念、代码评审的方式、单元测试、API
测试等内容。为了让测试的编写更容易，在这部分还介绍了测试替身，以及如何与
Spring
框架相结合来编写测试。这一篇的目标是让开发者顺利地上手测试编写相关工作。

研发测试高级篇（第7\~10章），首先详细讨论了如何验证并发应用以及构建流水线来自动运行测试，然后介绍了
TDD 和为重构编写测试等内容。这一篇的目标是为有单元测试、API
测试经验的读者提供一些专项技术，以便能在特殊的场景下使用测试保护代码。

源码分析篇（第11章），对常见测试框架和库的源码进行了分析，包括
JUnit、Hamcrest、Mockito、JaCoCo
等。通过探究测试框架的原理，让读者更为深刻地掌握测试技术，不仅可以修复测试问题，还能拓展测试框架。

另外，在书的最后还有两个附录。附录 A
为一份测试策略的样例和模板，便于读者在团队中推广研发自测。附录 B
为全书使用的开源工具和框架，方便读者快速找到相关内容的官方材料。

勘误和支持
----------

本书的内容来自日常的工作实践，因笔者水平有限，难免有疏漏之处，恳请指正。本书的所有示例代码通过
GitHub（https://github.com/linksgo2011/java-self-testing-example
）进行管理并保持更新。大家可以将书中的错误和运行示例代码的过程所出现的问题通过
GitHub 的 Issues 进行提交，我将尽量及时地回复和处理。

如果有其他宝贵意见也欢迎发送邮件到我的邮箱
linksgo2011\@gmail.com，期待收到大家的反馈。

本书所有的示例代码均使用开源的方式发布，可通过Git获取。为了便于管理，示例项目使用了Maven
的多模块项目组织代码。书中代码采用 Java 8
编写，要编译和运行代码示例，需要安装相应的环境，推荐的环境如下：

-   Git。

-   Java 8 及其以上。

-   Maven 3。

-   IntelliJ IDEA。

为了上手简单，代码示例大多使用经典的 JUnit 4构建，在部分章节也介绍了
JUnit 5 的新特性。所有的开源软件和工具在本书的附录中都可以找到。

致谢
----

首先感谢 Thoughtworks
这家有这独特开发者文化的软件公司，它不仅鼓励开发人员编写单元测试，还竭力支持大家把自己的经验分享出去。

感谢 Thoughtworks
的同事张凯峰老师给了我写一本书的建议和勇气。在一开始我只是写了一些文档用于自己或者新来的同事上手单元测试和自动化的
API
测试，随着积累的文档增多，我逐步将其整理成了专栏，继而在张凯峰老师的鼓励下开启了本书的写作。

感谢机械工业出版社华章公司的编辑杨绣国老师，感谢您的支持和指导，能让我在一年多的时间里一直坚持在正确的方向上，本书的完成离不开您辛勤的工作。

感谢一起工作过的同事，以及一些项目的前期开发者，他们留下的代码库让我学会了许多关于测试的编程技巧。

感谢社区的朋友帮助提前审读本书内容以避免一些明显的错误，他们是：刘泉乐(西门)、付施威。

最后感谢我的妻子，在编写本书的一年时间里我几乎用掉了所有的周末和节假日，感谢她分担了琐碎家务。

谨以此书，献给对软件质量有更高要求的开发者。

林宁

2022年7月
